<!DOCTYPE html>
<html>
<head>
    <title>Grist Tasks Widget - Updated</title>
    <script src="https://cdn.jsdelivr.net/npm/@gristlabs/grist-widget@latest/dist/grist-widget.js"></script>
</head>
<body>
    <h2>Welcome to Grist Tasks Widget!</h2>
    <p>This widget displays the number of tasks in the Dev-BackLog document.</p>
    <h3>Tasks Count</h3>
    <div id="count">Loading...</div>
    
    <!-- Updated on 2023-10-06 -->
    
    <script>
        // Fonction de mouchard pour envoyer les logs Ã  Goose
        const logToGoose = (msg) => {
            fetch('http://localhost:8080', { method: 'POST', body: JSON.stringify(msg) }).catch(() => {});
        };
        
        grist.onRecords((records) => {
            logToGoose({ event: 'data_received', count: records.length, firstRow: records[0] });
            const countElement = document.getElementById('count');
            countElement.textContent = `Number of tasks: ${records.length}`;
            logToGoose({ event: 'display_updated', count: records.length });
        });
        
        grist.onOptions((options) => {
            logToGoose({ event: 'options_received', options: options });
        });
    </script>
</body>
</html>
